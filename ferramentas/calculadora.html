<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Juros Compostos</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');

        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --background-color: #f4f6f9;
            --card-background: #ffffff;
            --text-color: #333;
            --light-text-color: #777;
            --border-color: #e1e1e1;
            --success-color: #27ae60;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background-color: var(--card-background);
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background-color: var(--secondary-color);
            color: white;
            padding: 20px;
            font-size: 1.2rem;
            font-weight: 500;
        }

        .simulator-body {
            padding: 25px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--secondary-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-group {
            display: flex;
        }

        .input-group span {
            padding: 10px 12px;
            background-color: #eee;
            border: 1px solid var(--border-color);
            border-right: none;
            border-radius: 4px 0 0 4px;
        }

        .form-control, .form-select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }
        
        .input-group .form-control { border-radius: 0; }
        .input-group .form-control:first-child { border-radius: 4px 0 0 4px; }
        .input-group span:last-child { border-radius: 0 4px 4px 0; border-right: 1px solid var(--border-color); border-left: none; }
        .input-group .form-select { border-left: none; border-radius: 0 4px 4px 0; background-color: #f8f9fa; }

        .form-control:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .actions {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            margin-top: 25px;
            gap: 15px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }
        
        .btn:active { transform: scale(0.98); }
        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-primary:hover { background-color: #2980b9; }
        .btn-light { background-color: #f0f0f0; color: var(--text-color); border: 1px solid var(--border-color); }
        .btn-light:hover { background-color: #e0e0e0; }

        .results-section, .table-section {
            margin-top: 30px;
            border-top: 1px solid var(--border-color);
            padding-top: 25px;
        }
        
        .table-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .section-title { font-size: 1.1rem; font-weight: 500; color: var(--secondary-color); border-left: 4px solid var(--primary-color); padding-left: 10px; margin: 0; }
        
        .view-toggle button { padding: 6px 12px; border: 1px solid var(--border-color); background-color: #f0f0f0; cursor: pointer; font-size: 0.85rem; color: var(--secondary-color); }
        .view-toggle button:first-child { border-radius: 4px 0 0 4px; border-right: none; }
        .view-toggle button:last-child { border-radius: 0 4px 4px 0; }
        .view-toggle button.active { background-color: var(--primary-color); color: white; border-color: var(--primary-color); }
        .view-toggle button:disabled { background-color: #e9ecef; cursor: not-allowed; color: #adb5bd; }

        .help-tooltip {
            position: relative;
            display: inline-block;
            background-color: var(--secondary-color);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            cursor: help;
            line-height: 18px;
        }
        .help-tooltip .tooltip-text {
            visibility: hidden;
            width: 240px;
            background-color: #555;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -120px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
            line-height: 1.5;
        }
        .help-tooltip .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #555 transparent transparent transparent;
        }
        .help-tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        .results-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; }
        .result-card { background-color: #f8f9fa; border: 1px solid var(--border-color); border-radius: 5px; padding: 15px; text-align: center; }
        .result-card.net-value { background-color: #eafaf1; border-color: var(--success-color); }
        .result-card h3 { font-size: 0.9rem; font-weight: 500; color: var(--light-text-color); margin-bottom: 8px; }
        .result-card p { font-size: 1.5rem; font-weight: 700; color: var(--secondary-color); }
        .result-card.net-value p { color: var(--success-color); }
        
        .calculation-summary { font-size: 0.85rem; color: var(--light-text-color); margin-top: 25px; padding: 12px; background-color: #f8f9fa; border-radius: 4px; text-align: center; border: 1px solid var(--border-color); word-wrap: break-word; }
        .table-responsive { width: 100%; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 0; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid var(--border-color); }
        thead { background-color: #f8f9fa; }
        th { font-weight: 500; color: var(--secondary-color); }
        tbody tr:last-child td { border-bottom: none; }
        tbody tr:hover { background-color: #f1f8ff; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">SIMULADOR DE JUROS COMPOSTOS</div>
        <div class="simulator-body">
            <form id="calculatorForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="initialValue">Valor Inicial</label>
                        <div class="input-group">
                            <span>R$</span>
                            <input type="text" id="initialValue" class="form-control" value="1.000,00" style="border-radius: 0 4px 4px 0;">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="interestRate">Taxa de Juros</label>
                        <div class="input-group">
                            <input type="text" id="interestRate" class="form-control" value="14,90">
                            <span>%</span>
                            <select id="rateType" class="form-select">
                                <option value="annual" selected>Anual</option>
                                <option value="monthly">Mensal</option>
                            </select>
                        </div>
                    </div>
                     <div class="form-group">
                        <label for="period">Período</label>
                        <div class="input-group">
                            <input type="number" id="period" class="form-control" value="30" style="border-radius: 4px 0 0 4px;">
                            <select id="periodType" class="form-select">
                                <option value="days" selected>Dias</option>
                                <option value="months">Meses</option>
                                <option value="years">Anos</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="monthlyInvestment">Investimento Mensal</label>
                        <div class="input-group">
                            <span>R$</span>
                            <input type="text" id="monthlyInvestment" class="form-control" value="0,00" style="border-radius: 0 4px 4px 0;">
                        </div>
                    </div>
                    <div class="form-group">
                         <label for="incomeTax">
                            Imposto de Renda (sobre o lucro)
                            <span class="help-tooltip">?
                                <span class="tooltip-text">
                                    <strong>Tabela Regressiva IR:</strong><br>
                                    - 22,5% (até 180 dias)<br>
                                    - 20,0% (de 181 a 360 dias)<br>
                                    - 17,5% (de 361 a 720 dias)<br>
                                    - 15,0% (acima de 720 dias)
                                </span>
                            </span>
                        </label>
                        <div class="input-group">
                            <input type="text" id="incomeTax" class="form-control" value="22,50">
                            <span style="border-radius: 0 4px 4px 0;">%</span>
                        </div>
                    </div>
                </div>
                <div class="actions">
                    <button type="button" class="btn btn-light" id="clearBtn">LIMPAR</button>
                    <button type="submit" class="btn btn-primary" id="calculateBtn">CALCULAR</button>
                </div>
            </form>

            <div id="results" class="hidden">
                <div class="results-section">
                    <h2 class="section-title">RESULTADO FINAL</h2>
                    <div class="results-grid">
                        <div class="result-card">
                            <h3>Total em Juros</h3>
                            <p id="totalInterestResult">R$ 0,00</p>
                        </div>
                        <div class="result-card">
                            <h3>Valor Total Investido</h3>
                            <p id="totalInvestedResult">R$ 0,00</p>
                        </div>
                         <div class="result-card">
                            <h3>Valor Total Bruto</h3>
                            <p id="finalValueResult">R$ 0,00</p>
                        </div>
                        <div class="result-card net-value">
                            <h3>Valor Total Líquido</h3>
                            <p id="netValueResult">R$ 0,00</p>
                        </div>
                    </div>
                    <div class="calculation-summary" id="calcSummary"></div>
                </div>

                <div class="table-section">
                    <div class="table-header">
                        <h2 class="section-title">TABELA DE EVOLUÇÃO</h2>
                        <div class="view-toggle">
                            <button id="viewByPeriodBtn" class="active">Ver por Mês/Ano</button>
                            <button id="viewByDayBtn">Ver por Dia</button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table id="evolutionTable">
                            <thead>
                                <tr>
                                    <th id="periodHeader">Ano</th>
                                    <th>Total Investido</th>
                                    <th>Total Juros</th>
                                    <th>Total Acumulado (Bruto)</th>
                                    <th>Total Líquido</th>
                                </tr>
                            </thead>
                            <tbody id="evolutionTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('calculatorForm');
            const clearBtn = document.getElementById('clearBtn');
            const resultsDiv = document.getElementById('results');
            const viewByPeriodBtn = document.getElementById('viewByPeriodBtn');
            const viewByDayBtn = document.getElementById('viewByDayBtn');
            let currentTableView = 'period';

            const parseCurrency = (value) => {
                if(typeof value !== 'string') value = String(value);
                return parseFloat(value.replace(/\./g, '').replace(',', '.')) || 0;
            }
            const formatCurrency = (value) => {
                return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
            };

            const generateTable = (finalValues) => {
                const initialValue = parseCurrency(document.getElementById('initialValue').value);
                const monthlyInvestment = parseCurrency(document.getElementById('monthlyInvestment').value);
                let interestRate = parseCurrency(document.getElementById('interestRate').value) / 100;
                let period = parseInt(document.getElementById('period').value) || 0;
                const rateType = document.getElementById('rateType').value;
                const periodType = document.getElementById('periodType').value;
                const incomeTaxRate = parseCurrency(document.getElementById('incomeTax').value) / 100;

                const annualRate = rateType === 'annual' ? interestRate : Math.pow(1 + interestRate, 12) - 1;
                
                let totalMonths;
                if (periodType === 'years') totalMonths = period * 12;
                else if (periodType === 'months') totalMonths = period;
                else totalMonths = period / 30.417; // Conversão aproximada de dias para meses

                const displayInYears = periodType === 'years' && totalMonths >= 12;

                const tableBody = document.getElementById('evolutionTableBody');
                const periodHeader = document.getElementById('periodHeader');
                tableBody.innerHTML = '';

                if (currentTableView === 'period') {
                    periodHeader.textContent = displayInYears ? 'Ano' : 'Mês';
                    const monthlyRate = Math.pow(1 + annualRate, 1/12) - 1;

                    let currentBalance = initialValue;
                    let totalInvested = initialValue;
                    
                    for (let i = 1; i <= Math.ceil(totalMonths); i++) {
                        let isLastPeriod = (i === Math.ceil(totalMonths));

                        currentBalance += currentBalance * monthlyRate;
                        currentBalance += monthlyInvestment;
                        totalInvested += monthlyInvestment;
                        
                        if ((displayInYears && i % 12 === 0) || !displayInYears || isLastPeriod) {
                            const periodLabel = displayInYears ? i / 12 : i;
                            const profit = isLastPeriod ? finalValues.profit : currentBalance - totalInvested;
                            const accumulated = isLastPeriod ? finalValues.accumulated : currentBalance;
                            const taxAmount = profit > 0 ? profit * incomeTaxRate : 0;
                            const netValue = accumulated - taxAmount;

                            tableBody.innerHTML += `
                                <tr>
                                    <td>${periodLabel}</td>
                                    <td>${formatCurrency(isLastPeriod ? finalValues.invested : totalInvested)}</td>
                                    <td>${formatCurrency(profit)}</td>
                                    <td>${formatCurrency(accumulated)}</td>
                                    <td>${formatCurrency(netValue)}</td>
                                </tr>`;
                        }
                    }
                } else {
                    periodHeader.textContent = 'Dia';
                    const dailyRate = Math.pow(1 + annualRate, 1 / 365) - 1;
                    
                    let totalDays;
                    if (periodType === 'years') totalDays = period * 365;
                    else if (periodType === 'months') totalDays = Math.round(period * 30.417);
                    else totalDays = period;

                    let currentBalance = initialValue;
                    let totalInvested = initialValue;
                    
                    for (let d = 1; d <= totalDays; d++) {
                        let isLastDay = (d === totalDays);

                        currentBalance += currentBalance * dailyRate;

                        if (d % 30 === 0 && d < totalDays && monthlyInvestment > 0) {
                            currentBalance += monthlyInvestment;
                            totalInvested += monthlyInvestment;
                        }
                        
                        const profit = isLastDay ? finalValues.profit : currentBalance - totalInvested;
                        const accumulated = isLastDay ? finalValues.accumulated : currentBalance;
                        const taxAmount = profit > 0 ? profit * incomeTaxRate : 0;
                        const netValue = accumulated - taxAmount;
                        
                        tableBody.innerHTML += `
                            <tr>
                                <td>${d}</td>
                                <td>${formatCurrency(isLastDay ? finalValues.invested : totalInvested)}</td>
                                <td>${formatCurrency(profit)}</td>
                                <td>${formatCurrency(accumulated)}</td>
                                <td>${formatCurrency(netValue)}</td>
                            </tr>`;
                    }
                }
            };

            const calculate = () => {
                const initialValue = parseCurrency(document.getElementById('initialValue').value);
                const monthlyInvestment = parseCurrency(document.getElementById('monthlyInvestment').value);
                let interestRate = parseCurrency(document.getElementById('interestRate').value) / 100;
                let period = parseInt(document.getElementById('period').value) || 0;
                const rateType = document.getElementById('rateType').value;
                const periodType = document.getElementById('periodType').value;
                const incomeTaxRate = parseCurrency(document.getElementById('incomeTax').value) / 100;
                
                const annualRate = rateType === 'annual' ? interestRate : Math.pow(1 + interestRate, 12) - 1;
                
                let totalMonths;
                if (periodType === 'years') totalMonths = period * 12;
                else if (periodType === 'months') totalMonths = period;
                else totalMonths = period / 30.417; // Período em meses para o cálculo final

                if (totalMonths > 60) {
                    viewByDayBtn.disabled = true;
                    if(currentTableView === 'day') {
                        currentTableView = 'period';
                        viewByPeriodBtn.classList.add('active');
                        viewByDayBtn.classList.remove('active');
                    }
                } else {
                    viewByDayBtn.disabled = false;
                }
                
                const monthlyRate = Math.pow(1 + annualRate, 1/12) - 1;
                let finalAccumulatedValue;
                const fvInitial = initialValue * Math.pow(1 + monthlyRate, totalMonths);
                const fvMonthly = monthlyInvestment > 0 ? monthlyInvestment * ( (Math.pow(1 + monthlyRate, totalMonths) - 1) / monthlyRate ) : 0;
                finalAccumulatedValue = fvInitial + fvMonthly;
                
                const finalTotalInvested = initialValue + (monthlyInvestment * Math.ceil(totalMonths));
                const finalProfit = finalAccumulatedValue - finalTotalInvested;
                
                const finalTaxAmount = finalProfit > 0 ? finalProfit * incomeTaxRate : 0;
                const finalNetValue = finalAccumulatedValue - finalTaxAmount;

                document.getElementById('totalInterestResult').textContent = formatCurrency(finalProfit);
                document.getElementById('totalInvestedResult').textContent = formatCurrency(finalTotalInvested);
                document.getElementById('finalValueResult').textContent = formatCurrency(finalAccumulatedValue);
                document.getElementById('netValueResult').textContent = formatCurrency(finalNetValue);

                const summary = document.getElementById('calcSummary');
                summary.innerHTML = `
                    <strong>Cálculo executado com:</strong>
                    Valor Inicial: ${formatCurrency(initialValue)} | 
                    Invest. Mensal: ${formatCurrency(monthlyInvestment)} | 
                    Taxa: ${(interestRate * 100).toFixed(2).replace('.',',')}% (${rateType === 'annual' ? 'Anual' : 'Mensal'}) | 
                    Período: ${period} ${periodType === 'years' ? 'Anos' : (periodType === 'months' ? 'Meses' : 'Dias')}
                `;
                
                resultsDiv.classList.remove('hidden');
                generateTable({
                    accumulated: finalAccumulatedValue,
                    invested: finalTotalInvested,
                    profit: finalProfit
                });
            };
            
            form.addEventListener('submit', (e) => { e.preventDefault(); calculate(); });
            clearBtn.addEventListener('click', () => { form.reset(); resultsDiv.classList.add('hidden'); });
            
            viewByPeriodBtn.addEventListener('click', () => {
                currentTableView = 'period';
                viewByPeriodBtn.classList.add('active');
                viewByDayBtn.classList.remove('active');
                calculate();
            });

            viewByDayBtn.addEventListener('click', () => {
                currentTableView = 'day';
                viewByDayBtn.classList.add('active');
                viewByPeriodBtn.classList.remove('active');
                calculate();
            });
            
            // CORRIGIDO: Nova função de máscara para porcentagens
            const applyPercentageMask = (e) => {
                let value = e.target.value.replace(/\D/g, '');
                if (value === '') {
                    e.target.value = '0,00';
                    return;
                }
                value = parseInt(value, 10).toString(); // Remove zeros à esquerda
                
                if (value.length < 3) {
                    value = value.padStart(3, '0');
                }
                
                value = value.slice(0, value.length - 2) + ',' + value.slice(value.length - 2);
                e.target.value = value;
            };

            const applyCurrencyMask = (e) => {
                let value = e.target.value.replace(/\D/g, '');
                if (value === '') value = '0';
                const numberValue = parseInt(value, 10) / 100;
                e.target.value = new Intl.NumberFormat('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(numberValue);
            };

            document.getElementById('interestRate').addEventListener('input', applyPercentageMask);
            document.getElementById('incomeTax').addEventListener('input', applyPercentageMask);
            document.querySelectorAll('#initialValue, #monthlyInvestment').forEach(input => {
                input.addEventListener('input', applyCurrencyMask);
            });

            calculate();
        });
    </script>
</body>
</html>
