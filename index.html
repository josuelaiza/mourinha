<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Quiz - CP N1</title>
  <style>
    /* Força o uso da fonte Arial em todos os elementos */
    * {
      font-family: Arial, sans-serif;
    }
    /* Container principal do quiz */
    .container {
      font-size: 16px;
      max-width: 800px;
      margin: 50px auto;
      background: #fff;
      padding: 20px 30px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      position: relative;
    }
    h1 {
      text-align: center;
      color: #333;
    }
    /* Botão para abrir o overlay de temas */
    .open-menu-btn {
      display: block;
      margin: 0 auto 20px auto;
      padding: 10px 20px;
      font-size: 1em;
      background-color: #007BFF;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    /* Container onde as questões são exibidas */
    #questionContainer {
      margin-top: 20px;
    }
    /* Overlay que cobre a tela para seleção de temas */
    #themeOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      z-index: 1000;
    }
    /* Conteúdo centralizado do overlay */
    .overlay-content {
      background: #fff;
      width: 300px;
      margin: 100px auto;
      padding: 20px;
      border-radius: 8px;
      text-align: left;
    }
    .overlay-content h2 {
      margin-top: 0;
      font-size: 1.2em;
    }
    .overlay-content label {
      display: block;
      margin-bottom: 10px;
      font-size: 1em;
      cursor: pointer;
    }
    .overlay-content input[type="checkbox"] {
      margin-right: 10px;
      cursor: pointer;
    }
    .overlay-content button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 1em;
      background-color: #28a745;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      display: block;
      width: 100%;
    }
    /* Contadores */
    .counters {
      text-align: center;
      margin-bottom: 20px;
      font-size: 1.1em !important;
      color: #555;
    }
    /* Força o mesmo tamanho de fonte para a questão e seu <strong> */
    .question,
    .question strong {
      font-size: 1.2em !important;
    }
    .question {
      margin-bottom: 20px;
    }
    .options {
      list-style-type: none;
      padding: 0;
    }
    .options li {
      margin-bottom: 10px;
    }
    .option-button {
      width: 100%;
      padding: 10px;
      font-size: 1em;
      border: none;
      border-radius: 4px;
      background-color: #007BFF;
      color: #fff;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .option-button:hover {
      background-color: #0056b3;
    }
    .option-button.selected {
      background-color: #0056b3;
    }
    .btn-group {
      text-align: center;
      margin-top: 20px;
    }
    .action-button {
      padding: 10px 20px;
      font-size: 1em;
      border: none;
      border-radius: 4px;
      margin: 0 10px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .responder {
      background-color: #28a745;
      color: #fff;
    }
    .responder:hover {
      background-color: #218838;
    }
    .pular {
      background-color: #dc3545;
      color: #fff;
    }
    .pular:hover {
      background-color: #c82333;
    }
    .feedback {
      margin-top: 20px;
      font-weight: bold;
      text-align: center;
      font-size: 1.2em !important;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Eddy Current - N1</h1>
    
    <!-- Botão para abrir o menu de temas -->
    <button class="open-menu-btn" onclick="showOverlay()">Selecionar Tópicos</button>
    
    <div class="counters">
      <span id="solvedCount">Questões Respondidas: 0</span> |
      <span id="remainingCount">Questões Restantes: 0</span>
    </div>
    
    <!-- Área onde as questões serão exibidas -->
    <div id="questionContainer">
      <!-- As questões serão carregadas aqui -->
    </div>
    
    <div id="feedback" class="feedback"></div>
  </div>
  
  <!-- Overlay para seleção de temas -->
  <div id="themeOverlay">
    <div class="overlay-content">
      <h2>Selecione os Tópicos</h2>
      <label>
        <input type="checkbox" class="theme-checkbox" value="Tipos de Ensaios Não Destrutivos" onchange="applyThemes()">
        Tipos de Ensaios Não Destrutivos
      </label>
      <label>
        <input type="checkbox" class="theme-checkbox" value="História">
        História
      </label>
      <label>
        <input type="checkbox" class="theme-checkbox" value="Generalidades do Ensaio">
        Generalidades do Ensaio
      </label>
      <label>
        <input type="checkbox" class="theme-checkbox" value="Princípios e Teoria do Ensaio">
        Princípios e Teoria do Ensaio
      </label>
      <label>
        <input type="checkbox" class="theme-checkbox" value="Fatores que Afetam o Ensaio" onchange="applyThemes()">
        Fatores que Afetam o Ensaio
      </label>
      <button onclick="applyThemesAndClose()">Aplicar Tópicos</button>
    </div>
  </div>
  
  <script>
    /***************************************************
     * Lógica do Quiz (mantém responder, pular, etc.)
     ***************************************************/
    let allQuestions = [];
    let pendingQuestions = [];
    let currentQuestion = null;
    let selectedOptionIndex = null;
    
    // Função para carregar as questões a partir do arquivo JSON
    function loadQuestions() {
      fetch('questions.json')
        .then(response => response.json())
        .then(data => {
          allQuestions = data;
          pendingQuestions = [...allQuestions];
          updateCounters();
          loadNextQuestion();
        })
        .catch(error => {
          console.error('Erro ao carregar as questões:', error);
        });
    }
    
    /* Função para mostrar o overlay de seleção de temas */
    function showOverlay() {
      document.getElementById("themeOverlay").style.display = "block";
    }
    
    /* Função para aplicar os temas selecionados e fechar o overlay */
    function applyThemesAndClose() {
      // Reinicia o array de questões pendentes (caso deseje reiniciar o quiz)
      pendingQuestions = allQuestions.filter(q => true);
      updateCounters();
      loadNextQuestion();
      document.getElementById("themeOverlay").style.display = "none";
    }
    
    /* Função que retorna os temas selecionados via checkbox */
    function getSelectedThemes() {
      const checkboxes = document.querySelectorAll('.theme-checkbox');
      let selected = [];
      checkboxes.forEach(cb => {
        if (cb.checked) {
          selected.push(cb.value);
        }
      });
      return selected;
    }
    
    /* Atualiza os contadores de questões respondidas e pendentes */
    function updateCounters() {
      const selectedThemes = getSelectedThemes();
      if (selectedThemes.length === 0) {
        document.getElementById("solvedCount").textContent = "Questões Respondidas: 0";
        document.getElementById("remainingCount").textContent = "Questões Restantes: 0";
        return;
      }
      const totalForThemes = allQuestions.filter(q => selectedThemes.includes(q.theme)).length;
      const pendingForThemes = pendingQuestions.filter(q => selectedThemes.includes(q.theme)).length;
      const solved = totalForThemes - pendingForThemes;
      document.getElementById("solvedCount").textContent = "Questões Respondidas: " + solved;
      document.getElementById("remainingCount").textContent = "Questões Restantes: " + pendingForThemes;
    }
    
    /* Carrega uma questão aleatória dentre os temas selecionados */
    function loadNextQuestion() {
      const selectedThemes = getSelectedThemes();
      const container = document.getElementById("questionContainer");
      const feedbackDiv = document.getElementById("feedback");
      feedbackDiv.textContent = "";
      
      if (selectedThemes.length === 0) {
        container.innerHTML = "<p style='text-align:center;'>Por favor, selecione ao menos um tópico.</p>";
        return;
      }
      
      const filtered = pendingQuestions.filter(q => selectedThemes.includes(q.theme));
      if (filtered.length === 0) {
        container.innerHTML = "<p style='text-align:center;'>Parabéns! Você concluiu todas as questões dos tópicos selecionados.</p>";
        return;
      }
      
      // Seleciona uma questão aleatória
      const randomIndex = Math.floor(Math.random() * filtered.length);
      currentQuestion = filtered[randomIndex];
      selectedOptionIndex = null;
      
      let html = "<div class='question'><strong>" + currentQuestion.question + "</strong></div>";
      html += "<ul class='options'>";
      currentQuestion.options.forEach((option, index) => {
        html += "<li><button type='button' class='option-button' onclick='selectOption(" + index + ")'>" + option + "</button></li>";
      });
      html += "</ul>";
      html += "<div class='btn-group'>";
      html += "<button type='button' class='action-button responder' onclick='submitAnswer()'>Responder</button>";
      html += "<button type='button' class='action-button pular' onclick='skipQuestion()'>Pular</button>";
      html += "</div>";
      
      container.innerHTML = html;
    }
    
    /* Registra a opção selecionada e atualiza os botões */
    function selectOption(index) {
      selectedOptionIndex = index;
      const buttons = document.querySelectorAll('.option-button');
      buttons.forEach((btn, idx) => {
        if (idx === index) {
          btn.classList.add('selected');
        } else {
          btn.classList.remove('selected');
        }
      });
    }
    
    /* Verifica a resposta ao clicar em "Responder" */
    function submitAnswer() {
      const feedbackDiv = document.getElementById("feedback");
      if (selectedOptionIndex === null) {
        alert("Por favor, selecione uma opção antes de responder.");
        return;
      }
      const qIndex = pendingQuestions.findIndex(q => q.id === currentQuestion.id);
      if (qIndex === -1) return;
      if (selectedOptionIndex === currentQuestion.answer) {
        feedbackDiv.style.color = "green";
        feedbackDiv.textContent = "Acertou!";
        pendingQuestions.splice(qIndex, 1);
      } else {
        feedbackDiv.style.color = "red";
        feedbackDiv.textContent = "Errou!";
        pendingQuestions.splice(qIndex, 1);
        pendingQuestions.push(currentQuestion);
      }
      updateCounters();
      setTimeout(loadNextQuestion, 1000);
    }
    
    /* Ação de pular a questão */
    function skipQuestion() {
      const feedbackDiv = document.getElementById("feedback");
      const qIndex = pendingQuestions.findIndex(q => q.id === currentQuestion.id);
      if (qIndex === -1) return;
      pendingQuestions.splice(qIndex, 1);
      pendingQuestions.push(currentQuestion);
      feedbackDiv.style.color = "blue";
      feedbackDiv.textContent = "Questão pulada!";
      updateCounters();
      setTimeout(loadNextQuestion, 1000);
    }
    
    // Inicializa o quiz após carregar as questões
    window.onload = function() {
      loadQuestions();
    }
  </script>
</body>
</html>
